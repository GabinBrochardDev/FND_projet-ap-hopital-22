/* Modification */

// Démarrage ou suite de la session
session_start();

// Initialisation de la variable indiquant le protocole du site Internet
$protocole = "";
// On vérifie le protocole du site Internet en 'HTTP' ou 'HTTPS'
if(isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] === 'on')
{
  $protocole = "https://";
}
else
{
  $protocole = "http://";
}  
// Affectation de la variable de session de la page en cours de l'utilisateur
$_SESSION['page'] = [
            'protocole' => $protocole,
            'adresse' => $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI']
          ];
// Affectation de la variable de session de connexion 
$_SESSION['connexion'] = true;





// Affectation de la variable de session avec les informations de la personne connectée
$_SESSION['user'] = [
                        'nom' => $row['Nom'],
                        'prenom' => $row['Prenom'],
                        'utilisateur' => $row['Utilisateur'],
                        'connexion' => $row['PremiereConnexion'],
                        'admin' => $row['Administrateur']
                    ];





// Si une connexion de session n'existe pas, on redirige à la page 'index.php'
if ( !isset($_SESSION['connexion']) || ($_SESSION['connexion'] == false) )
{
    header('Location: index.php');
}
// Si la variable de session de la connexion n'existe pas ou le mot de passe n'a pas été modifié, on affiche la page 'index.php'.
if ( !isset($_SESSION['user']['connexion']) || ($_SESSION['user']['connexion'] == 0) )
{
    header('Location: index.php');
}
//  Si la variable de session administrateur n'existe pas ou l'utilisateur n'est pas administrateur, on affiche la dernière page de l'utilisateur.
if ( !isset($_SESSION['user']['admin']) || ($_SESSION['user']['admin'] == 0) )
{
    // Si la variable de session de la page en cours existe, on l'affiche.
    if (isset($_SESSION['page']))
    {
        header('Location: '. $_SESSION['page']['protocole'] . $_SESSION['page']['adresse'] . '');
    }
    else // Sinon, on affiche la page 'index.php'.
    {
        header('Location: index.php');
    }
}
// Récupération de l'adresse du site Internet
$_SESSION['page']['adresse'] = $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'];
